<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Site-/Batch-Effect Correction PipeOp (block-specific, lean) — PipeOpSiteCorrection • mlr3mbspls</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Site-/Batch-Effect Correction PipeOp (block-specific, lean) — PipeOpSiteCorrection"><meta property="og:description" content="PipeOpSiteCorrection removes unwanted site / batch effects from
multi-block data inside an mlr3 pipeline. Behavior is controlled by
two named lists (by block):
site_correction: block -&amp;gt; specification of site/batch and optional covariates.
For &quot;partial_corr&quot;: a character vector of columns (categorical site and/or numeric covariates).
For &quot;dir&quot;: a single categorical column (protected attribute).
For &quot;combat&quot; (new structured format): a list with fixed elements
list(site = &amp;lt;character(1)&amp;gt;, covariates = &amp;lt;character()&amp;gt;).
The site column is mapped to ComBat's batch; the covariates are
encoded into a model matrix and passed as mod.
(Backward compatible: if a single string is provided, it is treated as site.)

method: block -&amp;gt; &quot;partial_corr&quot; | &quot;combat&quot; | &quot;dir&quot;. Missing blocks
default to &quot;partial_corr&quot;.


Blocks absent from site_correction are left unchanged."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mlr3mbspls</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/quickstart.html">Quick Start with mlr3mbspls</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/coorsaa/mlr3mbspls/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Site-/Batch-Effect Correction PipeOp (block-specific, lean)</h1>
    <small class="dont-index">Source: <a href="https://github.com/coorsaa/mlr3mbspls/blob/main/R/PipeOpSiteCorrection.R" class="external-link"><code>R/PipeOpSiteCorrection.R</code></a></small>
    <div class="hidden name"><code>PipeOpSiteCorrection.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>PipeOpSiteCorrection</code> removes unwanted <strong>site / batch effects</strong> from
<strong>multi-block data</strong> inside an <em>mlr3</em> pipeline. Behavior is controlled by
two named lists (by <strong>block</strong>):</p><ul><li><p><code>site_correction</code>: block -&gt; <strong>specification of site/batch and optional covariates</strong>.</p><ul><li><p>For <code>"partial_corr"</code>: a <strong>character vector of columns</strong> (categorical site and/or numeric covariates).</p></li>
<li><p>For <code>"dir"</code>: a <strong>single categorical column</strong> (protected attribute).</p></li>
<li><p>For <code>"combat"</code> (<strong>new structured format</strong>): a <strong>list</strong> with fixed elements
<code>list(site = &lt;character(1)&gt;, covariates = &lt;character()&gt;)</code>.
The <code>site</code> column is mapped to ComBat's <code>batch</code>; the <code>covariates</code> are
encoded into a model matrix and passed as <code>mod</code>.
<em>(Backward compatible: if a single string is provided, it is treated as <code>site</code>.)</em></p></li>
</ul></li>
<li><p><code>method</code>: <code>block -&gt; "partial_corr" | "combat" | "dir"</code>. Missing blocks
default to <code>"partial_corr"</code>.</p></li>
</ul><p>Blocks <strong>absent</strong> from <code>site_correction</code> are <strong>left unchanged</strong>.</p>
    </div>


    <div id="format">
    <h2>Format</h2>
    <p>R6 class inheriting from <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreproc.html" class="external-link">mlr3pipelines::PipeOpTaskPreproc</a></p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>An <a href="https://mlr3.mlr-org.com/reference/Task.html" class="external-link">mlr3::Task</a> with harmonized features.
Site/covariate columns referenced by <code>site_correction</code> are dropped unless <code>keep_site_col = TRUE</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><strong>Partial correlation (<code>"partial_corr"</code>)</strong></p><ul><li><p>If the site spec is a <strong>single categorical</strong> column, we build a dummy-coded
design with an intercept and keep a stable column layout across train/predict.
At predict-time, <strong>unseen site labels</strong> are treated as <strong>no-op rows</strong> (i.e.,
zero design contribution) or can be mapped to baseline if you set
<code>unknown_site = "baseline"</code>.</p></li>
<li><p>If the site spec is <strong>multiple columns</strong> (e.g., PRS PCs) or numeric,
we construct the design as <code>cbind(1, Z)</code> via <code>model.matrix(~ .)</code>.</p></li>
<li><p>We solve a ridge-stabilized normal equation for the site effects and
subtract them; optional mean re-add (<code>zero_center = FALSE</code> by default).</p></li>
</ul><p><strong>ComBat (<code>"combat"</code>, via <span class="pkg">neuroCombat</span>) - now with <code>mod</code> support</strong></p><ul><li><p>Trains using <code>neuroCombat(dat = t(X), batch = site, mod = MM, ...)</code>, where
<code>MM = model.matrix(~ ., data = covariates)</code>; character covariates are
auto-factorized. ComBat accepts <strong>one</strong> batch vector, but <strong>many covariates</strong>.
We store the returned <code>estimates</code>, the valid batch levels, the <code>site_var</code>,
and the list of <code>covariates</code>.</p></li>
<li><p>At predict, we apply <code>neuroCombatFromTraining(dat, batch, estimates)</code>.
The upstream function <strong>does not support</strong> supplying <code>mod</code> for new data;
if estimates were trained with <code>mod</code>, it uses an internal mean-imputation
of the training covariate effects. Unseen batches can be handled with
<code>combat_unknown = "noop"</code> (skip) or <code>"baseline"</code> (map to <code>ref_batch</code>).</p></li>
</ul><p><strong>DIR (<code>"dir"</code>, via <span class="pkg">fairmodels</span>)</strong></p><ul><li><p>Applies distribution repair per block with the given <code>lambda</code>.</p></li>
</ul><p>The operator preserves targets, reconstructs a backend with stable row ids,
and (by default) <strong>drops</strong> all site/covariate columns referenced in <code>site_correction</code>
unless <code>keep_site_col = TRUE</code>.</p>
    </div>
    <div id="construction">
    <h2>Construction</h2>


<div class="sourceCode"><pre><code><span></span>
<span><span class="va"><a href="../reference/PipeOpSiteCorrection.html">PipeOpSiteCorrection</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  id         <span class="op">=</span> <span class="st">"sitecorr"</span>,</span>
<span>  param_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>

    </div>
    <div id="tunable-hyper-parameters-self-param-set-">
    <h2>Tunable hyper-parameters (<code>self$param_set</code>)</h2>


<dl><dt><strong>Core</strong></dt>
<dd>
<ul><li><p><code>blocks</code> (<code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>): Named list of <strong>feature vectors</strong> per block
(non-numeric features are auto-dropped). If <code>NULL</code>, all numeric
features form one block <code>".all"</code>.</p></li>
<li><p><code>site_correction</code> (<code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>): Named list <strong>by block</strong>. For <code>"combat"</code>
use <code>list(site=&lt;char1&gt;, covariates=&lt;char_vec&gt;)</code>; for other methods,
character vectors as described above. Missing block =&gt; no correction.</p></li>
<li><p><code>method</code> (<code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>): Named list <code>block -&gt; "partial_corr"|"combat"|"dir"</code>.
Missing block =&gt; <code>"partial_corr"</code>.</p></li>
<li><p><code>keep_site_col</code> (<code>logical(1)</code>): Keep all site/covariate columns referenced by
<code>site_correction</code>? Default <code>FALSE</code>.</p></li>
</ul></dd>

<dt><strong>Partial-correlation</strong></dt>
<dd>
<ul><li><p><code>unknown_site</code> (<code>"other"|"baseline"</code>): Predict-time strategy for an
unseen <strong>categorical</strong> site under <code>"partial_corr"</code>. Default <code>"other"</code>.</p></li>
<li><p><code>zero_center</code> (<code>logical(1)</code>): Re-add grand means? Default <code>FALSE</code>.</p></li>
<li><p><code>revertflag</code> (<code>logical(1)</code>): Add instead of subtract the site effect.</p></li>
<li><p><code>regularization</code> (<code>numeric(1)</code>): Ridge penalty to stabilize the site
regression (<code>0</code> =&gt; internally <code>1e-6</code>).</p></li>
<li><p><code>subgroup</code> (<code><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical()</a></code>/<code><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer()</a></code>): Optional row subset for fitting.</p></li>
</ul></dd>

<dt><strong>ComBat (neuroCombat)</strong></dt>
<dd>
<ul><li><p><code>eb</code> (<code>logical(1)</code>): Empirical Bayes shrinkage. Default <code>TRUE</code>.</p></li>
<li><p><code>mean_only</code> (<code>logical(1)</code>): Adjust means only. Default <code>FALSE</code>.</p></li>
<li><p><code>ref_batch</code> (<code>character(1)</code> or <code>NULL</code>): Optional reference.</p></li>
<li><p><code>combat_unknown</code> (<code>"noop"|"baseline"</code>): Predict-time policy for
unseen batches. Default <code>"noop"</code>.</p></li>
</ul></dd>

<dt><strong>DIR (fairmodels)</strong></dt>
<dd>
<ul><li><p><code>lambda</code> (<code>numeric(1)</code> in [0,1]): Repair strength. Default <code>0.5</code>.</p></li>
</ul></dd>

<dt><strong>Misc</strong></dt>
<dd>
<ul><li><p><code>verbose</code> (<code>logical(1)</code>): Emit log messages via <span class="pkg">lgr</span>.</p></li>
</ul></dd>


</dl></div>
    <div id="state-after-train-">
    <h2>State (after <code>$train()</code>)</h2>


<p>A named list with:</p><ul><li><p><code>blocks</code>: Named list of <strong>effective</strong> block feature vectors used for training
(with any referenced site/covariate columns removed).</p></li>
<li><p><code>per_block</code>: Named list with one entry per corrected block:</p><ul><li><p><code>method</code>: <code>"partial_corr"|"combat"|"dir"</code>.</p></li>
<li><p><code>site_cols</code>: Character vector of all referenced site/covariate columns for that block.</p></li>
<li><p><code>design_kind</code>, <code>design_cols</code>, <code>beta</code>, <code>means</code>, <code>zero_center</code>, <code>revert</code> (partial_corr).</p></li>
<li><p><code>site_var</code> (<code>character(1)</code>), <code>covariates</code> (<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code>), <code>site_lvls</code>,
<code>estimates</code>, <code>ref_batch</code> (combat).</p></li>
<li><p><code>lambda</code>, <code>site_lvls</code> (dir).</p></li>
</ul></li>
<li><p><code>unknown_site</code>, <code>keep_site_col</code>.</p></li>
</ul></div>
    <div id="methods">
    <h2>Methods</h2>


<dl><dt><code>$train(task)</code></dt>
<dd><p>Fit correction parameters from an <a href="https://mlr3.mlr-org.com/reference/Task.html" class="external-link">mlr3::Task</a>.</p></dd>

<dt><code>$predict(task)</code></dt>
<dd><p>Apply the learnt correction and return a harmonized <code>Task</code>.</p></dd>


</dl></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreproc.html" class="external-link">mlr3pipelines::PipeOpTaskPreproc</a>,
<a href="https://rdrr.io/pkg/neuroCombat/man/neuroCombat.html" class="external-link">neuroCombat::neuroCombat</a> / <a href="https://rdrr.io/pkg/neuroCombat/man/neuroCombatFromTraining.html" class="external-link">neuroCombat::neuroCombatFromTraining</a>,
<a href="https://rdrr.io/pkg/fairmodels/man/disparate_impact_remover.html" class="external-link">fairmodels::disparate_impact_remover</a>.</p>
<p>Other PipeOps:
<code><a href="PipeOpMBsPLS.html">PipeOpMBsPLS</a></code>,
<code><a href="PipeOpTargetLabelFilter.html">PipeOpTargetLabelFilter</a></code></p></div>
    </div>
    <div id="super-classes">
    <h2>Super classes</h2>
    <p><code><a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html" class="external-link">mlr3pipelines::PipeOp</a></code> -&gt; <code><a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreproc.html" class="external-link">mlr3pipelines::PipeOpTaskPreproc</a></code> -&gt; <code>PipeOpSiteCorrection</code></p>
    </div>
    <div id="methods">
    <h2>Methods</h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-PipeOpSiteCorrection-new"><code>PipeOpSiteCorrection$new()</code></a></p></li>
<li><p><a href="#method-PipeOpSiteCorrection-clone"><code>PipeOpSiteCorrection$clone()</code></a></p></li>
</ul></div><p><details open><summary>Inherited methods</summary><ul><li><span class="pkg-link" data-pkg="mlr3pipelines" data-topic="PipeOp" data-id="help"><a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html#method-help"><code>mlr3pipelines::PipeOp$help()</code></a></span></li>
<li><span class="pkg-link" data-pkg="mlr3pipelines" data-topic="PipeOp" data-id="predict"><a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html#method-predict"><code>mlr3pipelines::PipeOp$predict()</code></a></span></li>
<li><span class="pkg-link" data-pkg="mlr3pipelines" data-topic="PipeOp" data-id="print"><a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html#method-print"><code>mlr3pipelines::PipeOp$print()</code></a></span></li>
<li><span class="pkg-link" data-pkg="mlr3pipelines" data-topic="PipeOp" data-id="train"><a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html#method-train"><code>mlr3pipelines::PipeOp$train()</code></a></span></li>
</ul></details></p><hr><a id="method-PipeOpSiteCorrection-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Create a new <code>PipeOpSiteCorrection</code> instance.</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/PipeOpSiteCorrection.html">PipeOpSiteCorrection</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"sitecorr"</span>, param_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>id</code></dt>
<dd><p><code>character(1)</code> Identifier for the new object. Default: <code>"sitecorr"</code>.</p></dd>


<dt><code>param_vals</code></dt>
<dd><p><code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> Named list of hyper-parameter values overriding defaults.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-PipeOpSiteCorrection-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">PipeOpSiteCorrection</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3pipelines.mlr-org.com" class="external-link">mlr3pipelines</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"pima"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># fake columns</span></span></span>
<span class="r-in"><span><span class="va">task</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="va">site</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">.N</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">task</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="va">Age</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">.N</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">task</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="va">Sex</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"M"</span><span class="op">)</span>, <span class="va">.N</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">po_site</span> <span class="op">=</span> <span class="va">PipeOpSiteCorrection</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>param_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  blocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="va">feature_names</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  site_correction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>site <span class="op">=</span> <span class="st">"site"</span>, covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Age"</span>, <span class="st">"Sex"</span><span class="op">)</span><span class="op">)</span> <span class="co"># &lt;-- ComBat with mod</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num <span class="op">=</span> <span class="st">"combat"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  keep_site_col <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  combat_unknown <span class="op">=</span> <span class="st">"noop"</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"copy"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span> <span class="va">po_site</span></span></span>
<span class="r-in"><span><span class="va">g</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Stefan Coors, Clara Sophie Vetter.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

