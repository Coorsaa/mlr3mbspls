% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/PipeOpMBsPCA.R
\name{PipeOpMBsPCA}
\alias{PipeOpMBsPCA}
\title{Multi-Block Sparse PCA (MB-sPCA) Transformer}
\value{
\itemize{
\item \strong{Training}: appends latent score columns and sets \verb{$state} as described.
\item \strong{Prediction}: appends latent score columns computed from stored weights.
\item \strong{Plot methods}: return a \code{ggplot} object.
}
}
\description{
\code{PipeOpMBsPCA} extracts up to \code{ncomp} \strong{sparse} principal components from
multiple, predefined feature blocks. Each component is estimated with a
GSMV-style algorithm (\code{cpp_mbspca_one_lv()}), and after extraction a
block-wise rank-1 deflation is applied so later components capture novel
structure. Optionally, a permutation test
(\code{perm_test_component_mbspca()}) can stop extraction early if a component
explains no more variance than expected under the null.

The operator appends one column per \emph{block × component} (name:
\verb{PC<k>_<block>}) to the feature table.
}
\details{
Multi-Block Sparse PCA (MB-sPCA) PipeOp

During training, non-numeric or constant features are silently removed from
each block. If \code{c_matrix} is supplied, its number of columns determines the
maximum number of components (overrides \code{ncomp}). Deflation is performed
block-wise after each component.
}
\section{Input and Output}{

\itemize{
\item \strong{Input}: \code{\link[mlr3:Task]{mlr3::Task}} with a table of numeric features (non-numeric or
constant features inside a block are dropped automatically).
\item \strong{Output}: the input task with additional columns containing the latent
scores for each block & component.
}
}

\section{State}{

The \verb{$state} stores:
\itemize{
\item \code{blocks}: the (sanitised) named list of block → feature names used.
\item \code{ncomp}: number of retained components.
\item \code{weights}: list(\code{PCk} → list(\code{block} → numeric named vector)).
\item \code{loadings}: same shape as \code{weights}, block-wise loadings used for deflation.
\item \code{ev_block}: matrix \verb{[components × blocks]} of variance explained by each PC
within each block.
\item \code{ev_comp}: numeric vector of total variance explained by each PC.
\item \code{T_mat}: numeric matrix of appended latent scores (column names match the
appended features).
}
}

\section{Parameters (ParamSet)}{

\itemize{
\item \code{blocks} (\code{uty}, \strong{required}; tag \code{"train"}): named list mapping block IDs
to character vectors of feature names.
\item \code{ncomp} (\code{int}, default \code{1}; tag \code{"train"}): number of components to target
(may be shortened by permutation early-stopping).
\item \code{permutation_test} (\code{lgl}, default \code{FALSE}; tag \code{"train"}): enable early-stop test.
\item \code{n_perm} (\code{int}, default \code{500}; tag \code{"train"}): permutations for the test.
\item \code{perm_alpha} (\code{dbl} in \verb{[0,1]}, default \code{0.05}; tag \code{"train"}): test α.
\item \verb{c_<block>} (one \code{dbl} per block, lower \code{1}, upper \verb{sqrt(#features in block)},
default \verb{sqrt(#features)}; tags \code{c("train","tune")}): √(L¹-budget) for that block.
\item \code{c_matrix} (\code{uty}, default \code{NULL}; tags \code{c("train","tune")}): optional
matrix (\verb{blocks × components}) overriding single-value \verb{c_<block>} parameters.
}
}

\section{Methods}{

\itemize{
\item \verb{$plot_variance()}: stacked bar chart of \code{ev_block}.
\item \verb{$plot_loadings(top_n = 20, palette = "Dark2")}: bar plots of top sparse
loadings per block/component.
\item \verb{$plot_scree(type = c("component","cumulative"))}: scree/cumulative EV.
\item \verb{$plot_score_heatmap(method = "spearman")}: heat-map of score correlations.
\item \verb{$plot_score_network(cutoff = 0.3, method = "spearman")}: network of score
correlations with |r| ≥ cutoff.
}
}

\section{Construction}{

\code{PipeOpMBsPCA$new(id = "mbspca", blocks, param_vals = list())}
}

\examples{
\dontrun{
library(mlr3)
library(mlr3pipelines)
task = tsk("mtcars")
blocks = list(eng = c("disp", "hp", "drat"),
  body = c("wt", "qsec"))
po = PipeOpMBsPCA$new(blocks = blocks, param_vals = list(ncomp = 2))
g = as_graph(po)
g$train(task)
print(po$plot_scree())
}

}
\seealso{
\link[mlr3pipelines:PipeOp]{mlr3pipelines::PipeOp}, \link[mlr3tuning:mlr3tuning-package]{mlr3tuning::mlr3tuning}, \code{TunerSeqMBsPCA}
}
\section{Super classes}{
\code{\link[mlr3pipelines:PipeOp]{mlr3pipelines::PipeOp}} -> \code{\link[mlr3pipelines:PipeOpTaskPreproc]{mlr3pipelines::PipeOpTaskPreproc}} -> \code{PipeOpMBsPCA}
}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{blocks}}{Named list mapping block names to feature columns (kept for predict()).}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-PipeOpMBsPCA-new}{\code{PipeOpMBsPCA$new()}}
\item \href{#method-PipeOpMBsPCA-plot_variance}{\code{PipeOpMBsPCA$plot_variance()}}
\item \href{#method-PipeOpMBsPCA-plot_loadings}{\code{PipeOpMBsPCA$plot_loadings()}}
\item \href{#method-PipeOpMBsPCA-plot_scree}{\code{PipeOpMBsPCA$plot_scree()}}
\item \href{#method-PipeOpMBsPCA-plot_score_heatmap}{\code{PipeOpMBsPCA$plot_score_heatmap()}}
\item \href{#method-PipeOpMBsPCA-plot_score_network}{\code{PipeOpMBsPCA$plot_score_network()}}
\item \href{#method-PipeOpMBsPCA-clone}{\code{PipeOpMBsPCA$clone()}}
}
}
\if{html}{\out{
<details open><summary>Inherited methods</summary>
<ul>
<li><span class="pkg-link" data-pkg="mlr3pipelines" data-topic="PipeOp" data-id="help"><a href='../../mlr3pipelines/html/PipeOp.html#method-PipeOp-help'><code>mlr3pipelines::PipeOp$help()</code></a></span></li>
<li><span class="pkg-link" data-pkg="mlr3pipelines" data-topic="PipeOp" data-id="predict"><a href='../../mlr3pipelines/html/PipeOp.html#method-PipeOp-predict'><code>mlr3pipelines::PipeOp$predict()</code></a></span></li>
<li><span class="pkg-link" data-pkg="mlr3pipelines" data-topic="PipeOp" data-id="print"><a href='../../mlr3pipelines/html/PipeOp.html#method-PipeOp-print'><code>mlr3pipelines::PipeOp$print()</code></a></span></li>
<li><span class="pkg-link" data-pkg="mlr3pipelines" data-topic="PipeOp" data-id="train"><a href='../../mlr3pipelines/html/PipeOp.html#method-PipeOp-train'><code>mlr3pipelines::PipeOp$train()</code></a></span></li>
</ul>
</details>
}}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-PipeOpMBsPCA-new"></a>}}
\if{latex}{\out{\hypertarget{method-PipeOpMBsPCA-new}{}}}
\subsection{Method \code{new()}}{
Create a new PipeOpMBsPCA.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{PipeOpMBsPCA$new(id = "mbspca", blocks, param_vals = list())}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{id}}{character(1). Identifier (default: "mbspca").}

\item{\code{blocks}}{named list. Block → character() of feature names (required).}

\item{\code{param_vals}}{list. Initial ParamSet values.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-PipeOpMBsPCA-plot_variance"></a>}}
\if{latex}{\out{\hypertarget{method-PipeOpMBsPCA-plot_variance}{}}}
\subsection{Method \code{plot_variance()}}{
Stacked bar plot of block-wise variance explained per component (training).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{PipeOpMBsPCA$plot_variance()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
A ggplot object.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-PipeOpMBsPCA-plot_loadings"></a>}}
\if{latex}{\out{\hypertarget{method-PipeOpMBsPCA-plot_loadings}{}}}
\subsection{Method \code{plot_loadings()}}{
Bar-plot of sparse loadings (top features) per block & component.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{PipeOpMBsPCA$plot_loadings(top_n = 20, palette = "Dark2")}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{top_n}}{integer(1). Number of features to show per block/component (default 20).}

\item{\code{palette}}{character(1) or character(2). Brewer palette name, or 2 custom fill colors (pos/neg).}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A ggplot object.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-PipeOpMBsPCA-plot_scree"></a>}}
\if{latex}{\out{\hypertarget{method-PipeOpMBsPCA-plot_scree}{}}}
\subsection{Method \code{plot_scree()}}{
Scree or cumulative variance-explained plot (training).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{PipeOpMBsPCA$plot_scree(type = c("component", "cumulative"))}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{type}}{character(1). One of "component" or "cumulative".}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A ggplot object.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-PipeOpMBsPCA-plot_score_heatmap"></a>}}
\if{latex}{\out{\hypertarget{method-PipeOpMBsPCA-plot_score_heatmap}{}}}
\subsection{Method \code{plot_score_heatmap()}}{
Heat-map of score correlations across appended PC score columns.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{PipeOpMBsPCA$plot_score_heatmap(method = "spearman")}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{method}}{character(1). Correlation method, e.g. "spearman" (default) or "pearson".}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A ggplot object.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-PipeOpMBsPCA-plot_score_network"></a>}}
\if{latex}{\out{\hypertarget{method-PipeOpMBsPCA-plot_score_network}{}}}
\subsection{Method \code{plot_score_network()}}{
Network of score correlations between PCs with |r| above a cutoff.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{PipeOpMBsPCA$plot_score_network(cutoff = 0.3, method = "spearman")}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{cutoff}}{numeric(1). Absolute correlation threshold in \verb{[0, 1]} (default 0.3).}

\item{\code{method}}{character(1). Correlation method, e.g. "spearman" (default) or "pearson".}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A ggplot object.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-PipeOpMBsPCA-clone"></a>}}
\if{latex}{\out{\hypertarget{method-PipeOpMBsPCA-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{PipeOpMBsPCA$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
